name: Auto Deploy

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Setup Miniconda
  run: |
    curl -O https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
    bash Miniconda3-latest-Linux-x86_64.sh -b -p $HOME/miniconda
    export PATH="$HOME/miniconda/bin:$PATH"
    hash -r
    conda config --set always_yes yes --set changeps1 no
    conda info -a
    conda create -n .venv python=3.11 -y
    conda activate .venv
    conda env update --file environment.yml
    - name: Install Dependencies
      run: pip install -r requirements.txt

    - name: Start Web App
      run: chainlit run pdf_qa.py -w
